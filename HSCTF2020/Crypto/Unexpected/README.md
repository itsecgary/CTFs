# Unexpected
**Category:** Crypto

**Points:** 100

**Description:**
> Alice, Bob, and Carol are really close friends; in fact, they are so close, they even share the same primes in their RSA public keys! Alice > has N = PQ, Bob has N = QR, and Carol has N = PR, where P,Q,R are 1024 bit primes. All three also use the same public exponent e = 65537.
> Can you recover the three plaintexts?
>
> **Author:** AC
>
> **Given:** unexpected.txt

## Writeup
From the description and the text file given, we can see that this is some
twisted version of RSA. If you are unfamiliar with RSA, hang on because this
isn't too easy if you don't understand it yet. I encourage you to read the Wiki
I put in the resources as well as other websites giving examples.

Basically, RSA usually has an **N = P*Q**, but this is a little different. We
have three different ciphertexts and three different N's to deal with.

So I am assuming that the following below matches respectively to the .txt file
given.

<img src="https://render.githubusercontent.com/render/math?math=N_{1} = P \cdot Q">

<img src="https://render.githubusercontent.com/render/math?math=N_{2} = Q \cdot R">

<img src="https://render.githubusercontent.com/render/math?math=N_{3} = P \cdot R">

Since we have three equations and three knowns, we can probably work this out.
Here's the math:

<img src="https://render.githubusercontent.com/render/math?math=Q = \frac{N_{2}}{R}"">

<img src="https://render.githubusercontent.com/render/math?math=P = \frac{N_{3}}{R}"">

<img src="https://render.githubusercontent.com/render/math?math=N_{1} = \frac{N_{3}}{R} \cdot \frac{N_{2}}{R}">

<img src="https://render.githubusercontent.com/render/math?math=N_{1} = \frac{N_{3} \cdot N_{2}}{R^2}">

<img src="https://render.githubusercontent.com/render/math?math=R^2 = \frac{N_{3} \cdot N_{2}}{N_{1}}">

<img src="https://render.githubusercontent.com/render/math?math=R = \sqrt{\frac{N_{3} \cdot N_{2}}{N_{1}}}">


Following these steps to isolate P and Q can give us similar answers. You also
could divide the appropriate N by R


Here is the output to my script:
```
-----------------------------------------------------------------------------------------------------------------
phi: 3895738302299059518129198422310169628530536557191890566210939781698372336257482186582163630847612416277492034959243510457939210010336159061758606919109259916143600981918456942199762738624796190838889500238780675229383463267807384154074134251073572174392024892486431125499446924573006208711810847272390619510267715478341382535579105584675673997982203778973283813503737131926142658191419941161164257547319794943883811280878885096660672763345495601914053572772464688944398278968911503771601753848356268487278305957060424301523898709351034955902146951194283368812207947125965045248566943026323694697043787381033801270628
d: 905024881402920200245922852429502915824304119554549855357455455336034893564248688385392088128155073284172547297778086374446869286164579118898863090215275069400282663986885376886207603270862596785359303006476277223055117387923881528690338190222242952150976989915710421376155140250911996698617882260740454736161648658891123321241312274389842937871416948210449762128177942743420082868675230849424383495703860079354120981298823955882306831590325625816584000571597340268527149507937159847454669916859547854171112626397988311804039822540999850521235139416405454783799471977551883881005107154367429875680785859533387618373
flag: b'flag{n0_0n3_3xp'
-----------------------------------------------------------------------------------------------------------------
phi: 3036683903819675505741091164945461947189004916494633766372176282409409694958701211748277050499101511956962003835932755555293255586827283990400451317444723234406968971873530093281591689832798646915816609347861047534121792409030834659241904646743453387504496246791081682741245482378149293399372654558929658581960048798293605082264581070963505109295072607249172619834489529823110742182685123132307321795995115486491236524357398246542818317495137394745528263555605271324314200817069662802883230041385249726748989486591785200139057355527310020359454945749706230370552400570507369464671540537160407575553116627107873474612
d: 1949006439818224984329272283917496465883563693829650123058926270152539786670855380468556350994761842889447072147807185207169998775481270831564065852353287355369643649601237412663130617047423737510413873674398877617647511392054320433826574837968931746015252843870993008852175240326412465145762118630884206309916314945795869670190809368569478545131431696274195460703085785021430751307357436780967131188564361241867660740101701976659452933286509364712775307840447755126335172939994220462909155213555514583460377264362272622693275089576044698206810708196437022873743772604746196527037841366168396842249275137495437416461
flag: b'3ct5_th3_sp4nis'
-----------------------------------------------------------------------------------------------------------------
phi: 4793455677299549137382284585015750073239112414361680529255951318217960300841340399094743130287927996565298160174555422185410320841942637374406558835150138631140265626020072464652973386772727192540062051929655235552439145036105501434801984612127808829810146844869487529177642676245549299371487478280457673839585943066849022337520545603509204219821850868445721914238164436588614152654669526278241319272348057855708723349268650822215550667738881235874405982991956631703034012350958220927976873112789326373350047289917675374669209722838179591673306110922540875421581379673701918694867142296015241867468105452451023716116
d: 2833344309736941490820680535488962362285987102057506146792148590340225309885894141937106663123025996474457483998991835827371179772879043694550578698384821860828411581561035249335900072581929383167018993357202565189593475447589223104221421180472207431667385880900166438886179135334240028671631016580380081010694420900004538311348870036601302364579685657595715023784396813167672231648329769580031314005404871526228611701847338076979202614811004185655473075806680440040162527586728406279017472735145534965757268900267496355706484066150501259170247831376434509240295092631641132892896582972413116857072790469765899518057
flag: b'h_inquisiti0n!}'
-----------------------------------------------------------------------------------------------------------------
[+] FLAG: flag{n0_0n3_3xp3ct5_th3_sp4nish_inquisiti0n!}
```

## Flag
flag{n0_0n3_3xp3ct5_th3_sp4nish_inquisiti0n!}

## Resources
- https://en.wikipedia.org/wiki/RSA_(cryptosystem)

- https://www.wolframalpha.com/

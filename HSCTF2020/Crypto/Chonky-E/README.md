# Chonky E
**Category:** Crypto

**Points:** 100

**Description:**
> **E**
>
> **Note:** P>Q
>
> **Author:** AC
>
> **Given:** ChonkyE.txt

## Writeup
From the text file given, we see two different cryptosystems in play: RSA and
Schmidt-Samoa. We are given the ciphertext encrypted by the Schmidt-Samoa
cryptosystem and the **n** and **e** from the RSA cryptosystem. I have given
links to the Wiki pages for both cryptosystems below.

Schmidt Samoa encryption is very similar to RSA encryption. The main two
differences is the **e** *(encryption key)* and **n**.

I'm not sure about any other ways to get this information, but I used
**RsaCtfTool** to get the *p*, *q*, and *d* for the respective *e* and *n*.

Here is the output of the program:
```
~/ctfs/hsctf2020/crypto/samoa$ python3 ~/tools/RsaCtfTool/RsaCtfTool.py -n 156749047558583013960513267351769479915110440411448078412590565797031533622509813352093119636835511977253033854388466854142753776146092587825440445182008237325262012698034419137157047927918635897378973846177552961727126115560551970797370239385129543828686170774323306933202481728884019420422360360849592983818405154473369790181636472137741865440233383956571081122982223602667853668754338360008279002325576495573847568301584365514417593244726435632222027817410359417329310347952169273512510934251453361933794586716533950489973436393834189505450956622286216819440777162804798432330933357058175885674184582816364542591313 -e 91043118409828550796773745518585981151180206101005135117565865602978722878478494447048783557571813980525643725323377488249838860897784683927029906188947001149632101513367258267329961684034661252866484981926055087386190015432964608927947646476193251820354738640453947833718397360834701566765504916472450194494897616371452996381159817427887623703639133290358520498419049175941584678802701606995099241245926884172985004839801270005583030514286561971825047719421487004569752638468907609110285739083279629747310953086535889932550905065172805818862336335628248528993024112446002398466115161473573451161053837400091893285717 --private

[*] Testing key /tmp/tmpgs29c3l6.
Can't load boneh_durfee because sage is not installed
Can't load ecm because sage is not installed
Can't load ecm2 because sage is not installed
Can't load qicheng because sage is not installed
Can't load roca because sage is not installed
Can't load smallfraction because sage is not installed
[*] Performing comfact_cn attack on /tmp/tmpgs29c3l6.
[*] Performing cube_root attack on /tmp/tmpgs29c3l6.
[*] Performing factordb attack on /tmp/tmpgs29c3l6.
[*] Performing fermat attack on /tmp/tmpgs29c3l6.
[*] Performing londahl attack on /tmp/tmpgs29c3l6.
[*] Performing mersenne_primes attack on /tmp/tmpgs29c3l6.
[*] Performing noveltyprimes attack on /tmp/tmpgs29c3l6.
[*] Performing partial_q attack on /tmp/tmpgs29c3l6.
[*] Performing pastctfprimes attack on /tmp/tmpgs29c3l6.
[*] Performing pollard_p_1 attack on /tmp/tmpgs29c3l6.
[*] Performing primefac attack on /tmp/tmpgs29c3l6.
[*] Performing siqs attack on /tmp/tmpgs29c3l6.
[!] Warning: Modulus too large for SIQS attack module
[*] Performing smallq attack on /tmp/tmpgs29c3l6.
[*] Performing wiener attack on /tmp/tmpgs29c3l6.

Results for /tmp/tmpgs29c3l6:

Private key :
-----BEGIN RSA PRIVATE KEY-----
MIIEXwIBAAKCAQEE2bEPIRfdrVNyfmzmWZaB9ydQSeEAV+BqZicqXDhPj2wfJZg2
r1BGm2bFYOfWmZ7XBxzPX/jhmeKGrRgRjSoom3aGG3Pxvrs7Ld6c7uPitwJpXMvX
akLyyfBfeZ4vi2kusdxmw7OuPqnoLYC7neO7LHjfNGQdxLkU5kjbie2RWb2n9opJ
HYoJsNLeB7SysRUWrh4PSyerquUzBnipxATHXdWkUo2IU6XsxJUSLLmdMO9m9B3e
/B7EiNGADI4SYf0+1DgiatfsI4sG72N7MHc7uosPotJP4fm+bUBa3GvBiZjF1ijF
HF3Ysfc0WRWlHryJktKdbHiS7vOGORXuZ/iBUQKCAQEC0TNOpXV3GyrNfiwp0CyX
jUhp9t4ZDkSyKQmykstZ4rI2sGBk1Va9CfuQdz2pgObbN3/I8EVdn0L1k2+hkeUa
7VArlFTAd/2TQmVK9kcqqZPzRSQ0U1zh9nqJB8WGq4C7MtJ1jKPYLi5A9EhyJb18
TEQ5vWreS5D/zaRmcVPyGFFizV2eu5rhWRe8WMbin63tCckmwbo24Dsg/9UHs/8r
EuuKXa6gjTrsvnh8a6xcSkOLo8WwhTrW+M/+BnW/BuMaYLeAid4Pk1UWDTrFceP/
kUUA1x/iPafhvo5FnHZT8aJ/bUAl9CqK1h7wjSz5ArnSiCXR3l9Mjy5e1q7VOYHD
VQJAW67Pb58KG9KV6WULShC0pxfbAwIj6AP46WShirm8/AlUqPQQzAAXetn2oNWB
4Sxt/QZy3W5cPvN+EI6R05uk/QKBgQHiep/6oT3VUgLU1e+048tZqumrGHhQzOzr
E60AVmh1uNwGazrIyM+fWvItgXveXJA60gFCBUyz6nn8r8j3jKiPrtGZTZ8zN6qW
66Y3sWSXB3JjI/OiHHIaFM2sJl9lqYCRZDVWz8M3gx3bE4IeFp47fjcd83J/36hq
f1vVWTg7iQKBgQKS1TtgUTN8XMo4qHP0sf161qhoBj5ICe/2WL+q6To9uYeZ/7BQ
R7cwvlpB7J9ViGrLe5HBDiomprMo5ABY4K0biQ4udRCMB9LxvlUpkRhnTWbKVlD1
aVjrXX06zoc0o56T/YxnaPpZeO0d2KzEBergGrqMgSVlD/Xl3SM0u+k9iQJAW67P
b58KG9KV6WULShC0pxfbAwIj6AP46WShirm8/AlUqPQQzAAXetn2oNWB4Sxt/QZy
3W5cPvN+EI6R05uk/QJAW67Pb58KG9KV6WULShC0pxfbAwIj6AP46WShirm8/AlU
qPQQzAAXetn2oNWB4Sxt/QZy3W5cPvN+EI6R05uk/QKBgQHbAH/3Q83q2VcaB1MF
uroXJsMXRHbDwBLofgBb480QW1MFsoPS4Ac0O6OgvYh6agstMle5CYyf1qJtncXR
hV+4FqmRF+30r8uH/475p9pLNIN8rTXIQO/sG8Qw0A+AHYGjKVCr530Ncwf6m/Om
KAdcdl95Bui9gj9QyqDAwCDf2Q==
-----END RSA PRIVATE KEY-----
```

From the private key, we can get our *d*, *p* and *q*:
```
~/ctfs/hsctf2020/crypto/samoa$ python3 ~/tools/RsaCtfTool/RsaCtfTool.py --dumpkey --key priv.key
private argument is not set, the private key will not be displayed, even if recovered.
n: 156749047558583013960513267351769479915110440411448078412590565797031533622509813352093119636835511977253033854388466854142753776146092587825440445182008237325262012698034419137157047927918635897378973846177552961727126115560551970797370239385129543828686170774323306933202481728884019420422360360849592983818405154473369790181636472137741865440233383956571081122982223602667853668754338360008279002325576495573847568301584365514417593244726435632222027817410359417329310347952169273512510934251453361933794586716533950489973436393834189505450956622286216819440777162804798432330933357058175885674184582816364542591313
e: 91043118409828550796773745518585981151180206101005135117565865602978722878478494447048783557571813980525643725323377488249838860897784683927029906188947001149632101513367258267329961684034661252866484981926055087386190015432964608927947646476193251820354738640453947833718397360834701566765504916472450194494897616371452996381159817427887623703639133290358520498419049175941584678802701606995099241245926884172985004839801270005583030514286561971825047719421487004569752638468907609110285739083279629747310953086535889932550905065172805818862336335628248528993024112446002398466115161473573451161053837400091893285717
d: 4801820624110300567381264152630360984400101198006662778338105999190025449039653722546363948393959163699344836724430590700225590643966670154013435626235133
p: 338808278305491368568107597536870102903517054340801660200304926784154444523223906451699772927968482815828890482348342203845897909840260655384526983598744312581591533978845446602589686620835190303243711955190856932946979670202446096542521271004217036632261094082852110229243380763789393081471800046961479400329
q: 462648222004918001013626929700851985161214529015962355517097297750332107059692278343607439888140451722661722449586909096508950271217838478793469222136256780856060573039970361424138955569021582604733404145398646735820327194382610835536537670219091779958808528053471059443883883244638910795974245528935198178697
```

From the note at the beginning of this problem, we see that **P>Q**, meaning we
need to switch our P and Q here.

Since we know the ciphertext is encrypted with the Schmidt-Samoa cryptosystem,
we have to calculate a new *N* and *e* for this system. The *N* and *e* will be
the exact same in this cryptosystem.

My script calculates the encryption key, then uses modular inverse to find the
decryption key and uses it on the cipher text:
```
~/ctfs/hsctf2020/crypto/samoa$ python3 samoa-crypto.py

[*] Decrypting Schmidt-Samoa Ciphertext
[+] flag: flag{remarkably_superb_acronym}
```

## Flag
flag{remarkably_superb_acronym}

## Resources
- https://en.wikipedia.org/wiki/Schmidt-Samoa_cryptosystem

- https://en.wikipedia.org/wiki/RSA_(cryptosystem)

- https://www.wolframalpha.com/
